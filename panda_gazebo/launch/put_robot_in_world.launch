<!--Launch file for adding the panda robot to the gazebo world-->
<launch>
    <!--TODO test other control types!-->
    <arg name="rviz" default="true"/>
    <arg name="load_gripper" default="true"/>
    <!--Here-->
    <arg name="debug" default="false"/>
    <!--Moveit arguments-->
    <arg name="moveit" default="true"/>
    <arg name="rviz_file" default=""/>
    <arg name="pipeline" default="ompl"/>
    <arg name="max_velocity_scaling_factor" default="1.0"/>
    <arg name="max_acceleration_scaling_factor" default="1.0"/>
    <!-- Gazebo specific options -->
    <arg name="gazebo" default="false"/>
    <arg name="gazebo_gui" default="true"/>
    <arg name="paused" default="false"/>
    <!--Control arguments-->
    <!--    The control type used for controlling the robot (Options: Trajectory, position, effort)-->
    <arg name="control_type" default="trajectory"/>

    <!--Retrieve the right hardware_interface for the control type-->
    <arg if="$(eval arg('control_type') == 'position')" name="hardware_interface" value="PositionJointInterface"/>
    <arg unless="$(eval arg('control_type') == 'position')" name="hardware_interface" value="EffortJointInterface"/>

    <!--Spawn the Panda robot-->
    <include file="$(find franka_gazebo)/launch/panda.launch">
        <arg name="gazebo" value="$(arg gazebo)"/>
        <arg unless="$(arg gazebo_gui)" name="headless" value="true"/>
        <arg if="$(arg gazebo_gui)" name="headless" value="false"/>
        <arg name="paused" value="$(arg paused)"/>
        <arg name="use_gripper" default="$(arg load_gripper)"/>
        <arg name="transmission" value="hardware_interface/$(arg hardware_interface)"/>
    </include>

    <!--Load Moveit configuration values-->
    <rosparam if="$(arg moveit)" file="$(find panda_gazebo)/cfg/controllers/moveit.yaml" command="load" />

    <!--Run the main MoveIt! executable without trajectory execution (we do not have controllers configured by default)-->
    <include ns="panda" if="$(arg moveit)" file="$(find panda_moveit_config)/launch/move_group.launch">
        <arg name="info" value="true"/>
        <arg name="debug" value="$(arg debug)"/>
        <arg name="pipeline" value="$(arg pipeline)" />
        <arg name="allow_trajectory_execution" value="true"/>
        <arg name="fake_execution" value="false"/>
        <arg name="load_gripper" value="$(arg load_gripper)"/>
        <arg name="load_robot_description" value="false"/>
    </include>

    <!--Load and start the controllers-->
    <include ns="panda" file="$(find panda_gazebo)/launch/load_controllers.launch">
        <arg name="moveit" default="$(arg moveit)"/>
        <arg name="control_type" value="$(arg control_type)"/>
        <arg name="load_gripper" value="$(arg load_gripper)"/>
    </include>

    <!--Load Moveit control services-->
    <!--FIXME: Load gripper false not working-->
    <!-- <node ns="panda" if="$(arg moveit)" pkg="panda_gazebo" type="panda_moveit_server.py" name="panda_moveit_planner_server" required="true">
        <param name="max_velocity_scaling_factor" value="$(arg max_velocity_scaling_factor)"/>
        <param name="max_acceleration_scaling_factor" value="$(arg max_acceleration_scaling_factor)"/>
    </node> -->

    <!--Load ros_control service-->
    <!-- <node ns="panda" pkg="panda_gazebo" type="panda_control_server.py" name="panda_control_server" required="true"/> -->

    <!--Load RViz-->
    <include ns="panda" if="$(arg rviz)" file="$(find panda_gazebo)/launch/panda_rviz.launch">
        <arg name="debug" value="$(arg debug)"/>
        <arg name="moveit" value="$(arg moveit)"/>
        <arg if="$(eval arg('rviz_file') != '')" name="rviz_file" value="$(arg rviz_file)"/>
    </include>
</launch>